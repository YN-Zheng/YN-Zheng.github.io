---
layout: post
title: 计网基础总结
date: '2021-04-06 20:30'
---

# 传输层

## 概述

- 管理端到端的通信连接(路由器没有传输层)
- 进程与进程的通信
  - 单机之间
    - Unix域套接字
    - 共享内存
  - 网络通信
- 端口:标记不同的网络进程
  - 16bits:0~65535
- 协议
  - TCP
  - UDP



## UDP协议

User Datagram Protocal

- 简单：不对数据做处理
- UDP首部：
  - 源端口号、目的端口号
  - UDP长度、UDP校验和



### 特点

- **无连接**协议：不建立连接
- **不保证可靠**的交付数据
  - 无法保证数据在网络中是否丢失
  - 想发就发
- UDP是面向报文传输的（TCP不是）

- UDP没有**拥塞控制**
- UDP首部开销很小



## TCP协议

### TCP简介

- **面向连接**的协议
- 一个连接有两端（点对点通信）
- 提供**可靠**的传输服务

- 提供**全双工**的通信

- 面向**字节流**的协议
  - 字节流：流入或流出进程的序列
  - 可能对用户的数据块进行合并或分拆



### TCP头部

![image-20200310181017631](https://yn-zheng.github.io/CSBasic/imgs/image-20200310181017631.png)

- 序号：0~2^32-1：一个字节一个序号。数据第一个字节的序号
- 确认号：0~3^32-1：一个字节一个确认号。期望受到数据的首字节序号
  - 确认号为N：N-1都已受到
- 数据偏移：占4位（比特）：0~15，单位为：32位字（每个偏移表示四个字节）
  - 数据偏离首部的距离：20~60字节
- TCP标记：占6位

![image-20200310181801504](https://yn-zheng.github.io/CSBasic/imgs/image-20200310181801504.png)

- 窗口：占16位，指明允许对方发送的数据量（1bit对应1字节）
- 校验和
- 紧急指针：URG=1时。指定紧急数据在报文的位置
- TCP选项（可选）



## 可靠传输

### 停止等待协议

- 发送消息后等待确认，再发下一个
- 消息、确认-超时、丢失，：重发

- 超时定时器：每发送一个消息，都需要设置一个定时器

- 简单，对信道利用率不高



### 连续ARQ协议

Automatic Repeat reQuest协议

- 滑动窗口
- 累计确认
- 提高信道利用率



### TCP的可靠传输

- 选择重传
  - 存于TCP选项：序号重传的边界，而不是指定字节
    - 原理：丢失时一般是直接丢失了一段字节



### TCP协议的流量控制

- 让发送方发送速率不要太快
- 用滑动窗口实现
  - 当收到窗口为0的消息，则停止发送并启动坚持定时器
  - 坚持定时器每隔一段时间发送一个窗口探测报文，避免死锁



### TCP协议的拥塞控制

- 流量控制：点对点的通信量
- 拥塞控制：考虑整个网络，全局性的考虑
  - 报文超时则认为是拥塞

- 慢启动算法
  - 每发送一次，只要网络不拥塞，就尝试将拥塞窗口调大（指数增长-》线性）







## TCP连接的建立：三次握手



![image-20200310212533979](https://yn-zheng.github.io/CSBasic/imgs/image-20200310212533979.png)

- SYN：连接请求
- 为什么发送方要发出三个确认报文？
  - 若只有两次：已经失效的连接请求建立第二条连接，产生私下的请求





### TCP连接的释放：四次释放

![image-20200310213121305](https://yn-zheng.github.io/CSBasic/imgs/image-20200310213121305.png)

- FIN：释放连接标签

- MSL：最长报文寿命（一般为2分钟）

- 等待定时器：
  - 确保发送方最后一次挥手报文可以正确到达对方
  - 确保当前所有连接的报文都已经过期



## 套接字与套接字编程

- 使用端口来标记不同的网络进程

- {IP:Port}：Socket（套接字）表示TCP连接的一端

- 通过套接字可以进行数据发送或接收

- TCP连接由两个套接字连接

  ![image-20200310213601911](https://yn-zheng.github.io/CSBasic/imgs/image-20200310213601911.png)

- C/S架构
  - 服务端：
    - 创建套接字
    - 绑定套接字
    - 监听套接字
    - 接收&处理信息
  - 客户端
    - 创建套接字
    - 连接套接字
    - 发送信息
- 域套接字和网络套接字的区别





# 应用层

## DNS服务

- 域名：点、字母、数字组成
- 点：分割不同的域
- www.taobao.com
  - 顶级域
    - 国家
      - cn, us, uk, ca
    - 通用
      - com, net, gov, org
  - 二级域
  - 三级域

- 树结构

![image-20200311094747319](https://yn-zheng.github.io/CSBasic/imgs/image-20200311094747319.png)



- 域名服务器





## DHCP协议

Dynamic Host Configuration Protocol：动态主机设置协议

- 局域网协议
- 应用UDP协议的应用层协议
- 即插即用联网
  - DHCP服务监听默认端口：67
  - 主机使用**UDP协议**广播DHCP发现报文
  - DHCP服务器发出DHCP提供报文
  - 主机向DHCP服务器发出DHCP请求报文
  - DHCP服务器回应并**提供IP地址**



## HTTP协议

HyperText Transfer Protocol

- 超文本：带超链接文本
- http(s)://<主机>:<端口80/443>/<路径>

- 可靠的数据传输协议（基于TCP协议）
  - 文本、图片、音频、文件。。。
- C/S架构
  - Web服务器
    - 硬件部分
    - 软件部分
      - 接收客户端连接（IP是？端口是？）
      - 接收**请求报文**
      - 处理请求
      - 访问Web资源
      - **构造应答报文**
      - 发送应答

### HTTP请求方法

- GET：获取指定的服务端资源
- POST：提交数据到服务端
- DELETE：删除指定的服务端资源
- UPDATE：更新指定的服务端资源

- 怎么指定？
  - 在地址中指定
  - 在请求数据中指定

![image-20200311101227867](https://yn-zheng.github.io/CSBasic/imgs/image-20200311101227867.png)



### HTTP工作结构



### HTTPS协议详解

- HTTP是明文传输的
  - 不安全
- HTTPS是安全的HTTP协议
  - http**(s)**://<主机>:**<端口>**/<路径>     443
- 加密模型
  - 对称加密：使用同一把要是加密、解密
  - 非对称加密：使用秘匙加密，使用秘匙解密。两个密匙“不一致”
    - 私钥：自己使用，不对外公开
    - 公钥：对外公开
  - 数字证书：可信任组织颁给特定对象的认证。
  - SSL：安全套接层
    - 数据安全和数据完整
    - 对传输层数据进行加密后传输
- 步骤
  - 443端口的TCP连接
  - SSL安全参数握手
    - 客户端生成随机数1，协议版本、加密算法  
    - 服务端生成随机数2，发送数字证书，确定加密算法（此时1、2都有）
      - 确认证书有效
      - 生成随机数3
      - 使用服务器的公钥加密随机数3（此时1、2、3都有）
    - 根据随机数1、2、3和相同的算法生成对称秘钥
    - 双方使用堆成秘钥进行加密通信
  - 客户端发送数据
  - 服务端发送数据
- 综合使用对称加密、非对称加密
